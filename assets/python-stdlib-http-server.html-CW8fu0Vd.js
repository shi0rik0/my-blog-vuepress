import{_ as s,c as a,d as e,o as p}from"./app-D9VVartN.js";const t={};function l(c,n){return p(),a("div",null,[...n[0]||(n[0]=[e(`<h1 id="python标准库的简易http服务器" tabindex="-1"><a class="header-anchor" href="#python标准库的简易http服务器"><span>Python标准库的简易HTTP服务器</span></a></h1><p>Python 标准库有一个名为<code>http.server</code>的模块，提供了简易的 HTTP 服务器功能。下面的示例代码用这个模块启动了一个简单的 HTTP 服务器。这个服务器只支持 POST 方法，会打印 POST 请求的信息，并返回一个固定的字符串。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> http<span class="token punctuation">.</span>server <span class="token keyword">import</span> BaseHTTPRequestHandler<span class="token punctuation">,</span> HTTPServer</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyHandler</span><span class="token punctuation">(</span>BaseHTTPRequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">do_POST</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;method:&#39;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>command<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;path:&#39;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>path<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;HTTP version:&#39;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>request_version<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;headers:&#39;</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>headers<span class="token punctuation">)</span></span>
<span class="line">        content_length <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">&#39;Content-Length&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">        body <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>read<span class="token punctuation">(</span>content_length<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;body:&#39;</span><span class="token punctuation">,</span> body<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        response <span class="token operator">=</span> <span class="token string">b&#39;Roger!&#39;</span></span>
<span class="line">        self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span></span>
<span class="line">        self<span class="token punctuation">.</span>send_header<span class="token punctuation">(</span><span class="token string">&#39;Content-Length&#39;</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    server <span class="token operator">=</span> HTTPServer<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&#39;0.0.0.0&#39;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">,</span> MyHandler<span class="token punctuation">)</span></span>
<span class="line">    server<span class="token punctuation">.</span>serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>要测试这个服务器，可以发送一个简单的 POST 请求：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> requests</span>
<span class="line"></span>
<span class="line">res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&#39;http://localhost:8080/&#39;</span><span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token string">&#39;Hello!&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在服务端应该会看到类似下面的输出：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">method: POST</span>
<span class="line">path: /</span>
<span class="line">HTTP version: HTTP/1.1</span>
<span class="line">headers: Host: localhost:8080</span>
<span class="line">User-Agent: python-requests/2.32.3</span>
<span class="line">Accept-Encoding: gzip, deflate</span>
<span class="line">Accept: */*</span>
<span class="line">Connection: keep-alive</span>
<span class="line">Content-Length: 6</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">body: Hello!</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>而客户端则会收到如下的响应：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">Roger!</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>下面对示例代码的关键部分进行更加详细地说明。</p><p>HTTP 服务器的具体逻辑是通过继承<code>BaseHTTPRequestHandler</code>基类来实现的。当 HTTP 服务器收到 GET 请求时，就会调用对象的<code>do_GET()</code>方法，收到 POST 请求时会调用对象的<code>do_POST()</code>方法，以此类推。</p><p><code>BaseHTTPRequestHandler</code>基类提供了访问 HTTP 请求内容以及发送响应的接口。</p><p>HTTP 请求的 request line 可以通过<code>command</code>、<code>path</code>和<code>request_version</code>属性来获取，它们都是字符串。请求的头部信息可以通过<code>headers</code>属性获取。<code>headers</code>的类型是<code>http.client.HTTPMessage</code>，是一个类似于<code>dict</code>的对象。通过读取<code>rfile</code>，可以读取请求的 body 部分。</p><p>发送响应只需要往<code>wfile</code>中写入数据即可。发送 HTTP 响应的响应码和头部的时候，用<code>send_response()</code>和<code>send_header()</code>方法会更加方便，这些方法的底层实现依然是往<code>wfile</code>中写入数据，真正写入数据是在调用<code>end_headers()</code>的时候。</p><p><code>http.server</code>模块本身也提供了一个已经实现了的子类<code>SimpleHTTPRequestHandler</code>。通过在命令行输入<code>python -m http.server 8080</code>就可以快速启动一个使用了<code>SimpleHTTPRequestHandler</code>的 HTTP 服务器。</p>`,15)])])}const o=s(t,[["render",l]]),u=JSON.parse(`{"path":"/posts/2024/06/python-stdlib-http-server.html","title":"Python标准库的简易HTTP服务器","lang":"zh-CN","frontmatter":{"date":"2024-06-30T00:00:00.000Z"},"headers":[],"git":{"updatedTime":1763699399000,"contributors":[{"name":"shi0rik0","username":"shi0rik0","email":"anguuan@outlook.com","commits":2,"url":"https://github.com/shi0rik0"}],"changelog":[{"hash":"35d50711ef3a591a2383977aa02873c707aa5c1e","time":1763699399000,"email":"anguuan@outlook.com","author":"shi0rik0","message":"Organize files by date"},{"hash":"27621ea60c6645dc9e44007e7ab6fd2858c37eaf","time":1763698804000,"email":"anguuan@outlook.com","author":"shi0rik0","message":"Migrate posts"}]},"filePathRelative":"posts/2024/06/python-stdlib-http-server.md","excerpt":"\\n<p>Python 标准库有一个名为<code>http.server</code>的模块，提供了简易的 HTTP 服务器功能。下面的示例代码用这个模块启动了一个简单的 HTTP 服务器。这个服务器只支持 POST 方法，会打印 POST 请求的信息，并返回一个固定的字符串。</p>\\n<div class=\\"language-python line-numbers-mode\\" data-highlighter=\\"prismjs\\" data-ext=\\"py\\"><pre><code><span class=\\"line\\"><span class=\\"token keyword\\">from</span> http<span class=\\"token punctuation\\">.</span>server <span class=\\"token keyword\\">import</span> BaseHTTPRequestHandler<span class=\\"token punctuation\\">,</span> HTTPServer</span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">MyHandler</span><span class=\\"token punctuation\\">(</span>BaseHTTPRequestHandler<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">    <span class=\\"token keyword\\">def</span> <span class=\\"token function\\">do_POST</span><span class=\\"token punctuation\\">(</span>self<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span></span>\\n<span class=\\"line\\">        <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'method:'</span><span class=\\"token punctuation\\">,</span> self<span class=\\"token punctuation\\">.</span>command<span class=\\"token punctuation\\">)</span></span>\\n<span class=\\"line\\">        <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'path:'</span><span class=\\"token punctuation\\">,</span> self<span class=\\"token punctuation\\">.</span>path<span class=\\"token punctuation\\">)</span></span>\\n<span class=\\"line\\">        <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'HTTP version:'</span><span class=\\"token punctuation\\">,</span> self<span class=\\"token punctuation\\">.</span>request_version<span class=\\"token punctuation\\">)</span></span>\\n<span class=\\"line\\">        <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'headers:'</span><span class=\\"token punctuation\\">,</span> self<span class=\\"token punctuation\\">.</span>headers<span class=\\"token punctuation\\">)</span></span>\\n<span class=\\"line\\">        content_length <span class=\\"token operator\\">=</span> <span class=\\"token builtin\\">int</span><span class=\\"token punctuation\\">(</span>self<span class=\\"token punctuation\\">.</span>headers<span class=\\"token punctuation\\">[</span><span class=\\"token string\\">'Content-Length'</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">)</span></span>\\n<span class=\\"line\\">        body <span class=\\"token operator\\">=</span> self<span class=\\"token punctuation\\">.</span>rfile<span class=\\"token punctuation\\">.</span>read<span class=\\"token punctuation\\">(</span>content_length<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span>decode<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span></span>\\n<span class=\\"line\\">        <span class=\\"token keyword\\">print</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'body:'</span><span class=\\"token punctuation\\">,</span> body<span class=\\"token punctuation\\">)</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\">        response <span class=\\"token operator\\">=</span> <span class=\\"token string\\">b'Roger!'</span></span>\\n<span class=\\"line\\">        self<span class=\\"token punctuation\\">.</span>send_response<span class=\\"token punctuation\\">(</span><span class=\\"token number\\">200</span><span class=\\"token punctuation\\">)</span></span>\\n<span class=\\"line\\">        self<span class=\\"token punctuation\\">.</span>send_header<span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'Content-Length'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token builtin\\">len</span><span class=\\"token punctuation\\">(</span>response<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span></span>\\n<span class=\\"line\\">        self<span class=\\"token punctuation\\">.</span>end_headers<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span></span>\\n<span class=\\"line\\">        self<span class=\\"token punctuation\\">.</span>wfile<span class=\\"token punctuation\\">.</span>write<span class=\\"token punctuation\\">(</span>response<span class=\\"token punctuation\\">)</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span class=\\"token keyword\\">if</span> __name__ <span class=\\"token operator\\">==</span> <span class=\\"token string\\">'__main__'</span><span class=\\"token punctuation\\">:</span></span>\\n<span class=\\"line\\">    server <span class=\\"token operator\\">=</span> HTTPServer<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">'0.0.0.0'</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">8080</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span> MyHandler<span class=\\"token punctuation\\">)</span></span>\\n<span class=\\"line\\">    server<span class=\\"token punctuation\\">.</span>serve_forever<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span></span>\\n<span class=\\"line\\"></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>"}`);export{o as comp,u as data};
