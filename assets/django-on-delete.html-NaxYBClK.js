import{_ as s,c as a,d as e,o}from"./app-D9VVartN.js";const t={};function p(c,n){return o(),a("div",null,[...n[0]||(n[0]=[e(`<h1 id="django外键的on-delete参数" tabindex="-1"><a class="header-anchor" href="#django外键的on-delete参数"><span>Django外键的on_delete参数</span></a></h1><p>在 Django 的 ORM 框架中，通过<code>models.ForeignKey</code>可以很方便地创建外键字段。请看下面的例子：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Manufacturer</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Car</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    manufacturer <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Manufacturer<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>PROTECT<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在创建外键的时候，必须指定<code>on_delete</code>参数。在早期的 Django 版本中，这个参数有一个默认值<code>CASCADE</code>，而这个选项是非常危险的。假如数据库中有一些 Car 的 Manufacturer 是 BMW，那么如果设置了<code>CASCADE</code>，删除 BMW 就会将由 BMW 生产的所有 Car 的记录也一并删除，这样很可能导致数据丢失。如果设置为<code>PROTECT</code>，就会拒绝这次删除操作，并抛出一个异常。事实上，在生产环境中，往往很少直接删除记录，最多就是用一个专门的<code>deleted</code>字段来进行伪删除，因此将<code>on_delete</code>设置为<code>PROTECT</code>是我心目中的最佳实践。（<code>on_delete</code>还有一些安全性介于<code>CASCADE</code>和<code>PROTECT</code>之间的选项，例如<code>SET_NULL</code>和<code>RESTRICT</code>等等，这里就不赘述了。）</p>`,4)])])}const i=s(t,[["render",p]]),d=JSON.parse('{"path":"/posts/2024/11/django-on-delete.html","title":"Django外键的on_delete参数","lang":"zh-CN","frontmatter":{"date":"2024-11-11T00:00:00.000Z"},"headers":[],"git":{"updatedTime":1763699399000,"contributors":[{"name":"shi0rik0","username":"shi0rik0","email":"anguuan@outlook.com","commits":2,"url":"https://github.com/shi0rik0"}],"changelog":[{"hash":"35d50711ef3a591a2383977aa02873c707aa5c1e","time":1763699399000,"email":"anguuan@outlook.com","author":"shi0rik0","message":"Organize files by date"},{"hash":"27621ea60c6645dc9e44007e7ab6fd2858c37eaf","time":1763698804000,"email":"anguuan@outlook.com","author":"shi0rik0","message":"Migrate posts"}]},"filePathRelative":"posts/2024/11/django-on-delete.md","excerpt":"\\n<p>在 Django 的 ORM 框架中，通过<code>models.ForeignKey</code>可以很方便地创建外键字段。请看下面的例子：</p>\\n<div class=\\"language-python line-numbers-mode\\" data-highlighter=\\"prismjs\\" data-ext=\\"py\\"><pre><code><span class=\\"line\\"><span class=\\"token keyword\\">from</span> django<span class=\\"token punctuation\\">.</span>db <span class=\\"token keyword\\">import</span> models</span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Manufacturer</span><span class=\\"token punctuation\\">(</span>models<span class=\\"token punctuation\\">.</span>Model<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span></span>\\n<span class=\\"line\\">    name <span class=\\"token operator\\">=</span> models<span class=\\"token punctuation\\">.</span>TextField<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Car</span><span class=\\"token punctuation\\">(</span>models<span class=\\"token punctuation\\">.</span>Model<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">:</span></span>\\n<span class=\\"line\\">    manufacturer <span class=\\"token operator\\">=</span> models<span class=\\"token punctuation\\">.</span>ForeignKey<span class=\\"token punctuation\\">(</span>Manufacturer<span class=\\"token punctuation\\">,</span> on_delete<span class=\\"token operator\\">=</span>models<span class=\\"token punctuation\\">.</span>PROTECT<span class=\\"token punctuation\\">)</span></span>\\n<span class=\\"line\\"></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>"}');export{i as comp,d as data};
