import{_ as n,c as a,d as e,o as p}from"./app-DDoPRsSr.js";const t={};function l(i,s){return p(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="用setuptools打包资源文件" tabindex="-1"><a class="header-anchor" href="#用setuptools打包资源文件"><span>用setuptools打包资源文件</span></a></h1><p>默认情况下，setuptools 只会打包 Python 源代码文件，但有时候我们还需要打包一些资源文件，比如配置文件、模板文件、图片等等。这篇文章将会介绍如何用 setuptools 打包资源文件，并在库执行的时候访问这些文件。</p><p>我们假设项目的目录结构如下：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">myproject/</span>
<span class="line">├── mypkg/</span>
<span class="line">│   ├── __init__.py</span>
<span class="line">│   └── data/</span>
<span class="line">│       ├── template.txt</span>
<span class="line">└── setup.py</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="指定要打包的资源文件" tabindex="-1"><a class="header-anchor" href="#指定要打包的资源文件"><span>指定要打包的资源文件</span></a></h2><p>要打包 <code>mypkg/data/template.txt</code> ，我们需要在 <code>setup.py</code> 中添加如下代码：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> setuptools <span class="token keyword">import</span> setup</span>
<span class="line"></span>
<span class="line">setup<span class="token punctuation">(</span></span>
<span class="line">    <span class="token comment"># ...</span></span>
<span class="line">    include_package_data<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span></span>
<span class="line">    package_data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#39;mypkg&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#39;data/template.txt&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment"># ...</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>package_data</code>参数也可以使用 glob 模式，比如<code>mypkg&#39;: [&#39;data/*.txt&#39;]</code>。</p><h2 id="访问资源文件" tabindex="-1"><a class="header-anchor" href="#访问资源文件"><span>访问资源文件</span></a></h2><p>可以使用<code>importlib.resources</code>模块来访问资源文件。这个模块是在 Python 3.7 中引入的。</p><p>使用<code>open_text</code>或者<code>open_binary</code>方法来打开资源文件：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> mypkg</span>
<span class="line"><span class="token keyword">import</span> importlib<span class="token punctuation">.</span>resources</span>
<span class="line"></span>
<span class="line">anchor <span class="token operator">=</span> mypkg  <span class="token comment"># 也可以是字符串&#39;mypkg&#39;</span></span>
<span class="line"><span class="token keyword">with</span> importlib<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>open_text<span class="token punctuation">(</span>anchor<span class="token punctuation">,</span> <span class="token string">&#39;data/template.txt&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,12)])])}const o=n(t,[["render",l]]),d=JSON.parse('{"path":"/posts/setuptools-package-data.html","title":"用setuptools打包资源文件","lang":"zh-CN","frontmatter":{"date":"2025-01-13T00:00:00.000Z"},"headers":[{"level":2,"title":"指定要打包的资源文件","slug":"指定要打包的资源文件","link":"#指定要打包的资源文件","children":[]},{"level":2,"title":"访问资源文件","slug":"访问资源文件","link":"#访问资源文件","children":[]}],"git":{"updatedTime":1763698804000,"contributors":[{"name":"shi0rik0","username":"shi0rik0","email":"anguuan@outlook.com","commits":1,"url":"https://github.com/shi0rik0"}],"changelog":[{"hash":"27621ea60c6645dc9e44007e7ab6fd2858c37eaf","time":1763698804000,"email":"anguuan@outlook.com","author":"shi0rik0","message":"Migrate posts"}]},"filePathRelative":"posts/setuptools-package-data.md","excerpt":"\\n<p>默认情况下，setuptools 只会打包 Python 源代码文件，但有时候我们还需要打包一些资源文件，比如配置文件、模板文件、图片等等。这篇文章将会介绍如何用 setuptools 打包资源文件，并在库执行的时候访问这些文件。</p>\\n<p>我们假设项目的目录结构如下：</p>\\n<div class=\\"language-text line-numbers-mode\\" data-highlighter=\\"prismjs\\" data-ext=\\"text\\"><pre><code><span class=\\"line\\">myproject/</span>\\n<span class=\\"line\\">├── mypkg/</span>\\n<span class=\\"line\\">│   ├── __init__.py</span>\\n<span class=\\"line\\">│   └── data/</span>\\n<span class=\\"line\\">│       ├── template.txt</span>\\n<span class=\\"line\\">└── setup.py</span>\\n<span class=\\"line\\"></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>"}');export{o as comp,d as data};
