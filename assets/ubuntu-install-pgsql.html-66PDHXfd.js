import{_ as e,c as n,d as a,o as l}from"./app-D9VVartN.js";const i={};function t(p,s){return l(),n("div",null,[...s[0]||(s[0]=[a(`<h1 id="ubuntu安装postgresql的教程" tabindex="-1"><a class="header-anchor" href="#ubuntu安装postgresql的教程"><span>Ubuntu安装PostgreSQL的教程</span></a></h1><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h2><p>使用包管理器就可以直接安装 PostgreSQL：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> postgresql</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="配置" tabindex="-1"><a class="header-anchor" href="#配置"><span>配置</span></a></h2><h3 id="创建新用户和数据库" tabindex="-1"><a class="header-anchor" href="#创建新用户和数据库"><span>创建新用户和数据库</span></a></h3><p>默认情况下，PostgreSQL 会创建一个名为<code>postgres</code>的数据库超级用户以及一个同名的 Unix 用户（注意区分数据库用户和 Unix 用户的概念）。<code>postgres</code>数据库用户没有密码，只有在主机上登入<code>postgres</code> Unix 用户之后，才有权限登入<code>postgres</code>数据库用户。<code>psql</code>是 PostgreSQL 的客户端命令行工具。输入下面的命令就可以通过<code>postgres</code>数据库用户来操纵数据库。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token parameter variable">-u</span> postgres psql</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后输入以下命令，就可以创建一个名为<code>user1</code>的用户和名为<code>db1</code>的数据库，并赋予<code>user1</code>操纵<code>db1</code>的所有权限。</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> user1 <span class="token keyword">WITH</span> PASSWORD <span class="token string">&#39;your_password&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> db1<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">PRIVILEGES</span> <span class="token keyword">ON</span> <span class="token keyword">DATABASE</span> db1 <span class="token keyword">TO</span> user1<span class="token punctuation">;</span></span>
<span class="line">\\c db1 postgres</span>
<span class="line"><span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">ON</span> <span class="token keyword">SCHEMA</span> <span class="token keyword">public</span> <span class="token keyword">TO</span> user1<span class="token punctuation">;</span></span>
<span class="line">\\q</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>顺带一提，可以通过<code>pwgen</code>命令生成一个随机的 16 位强密码：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> pwgen</span>
<span class="line">pwgen <span class="token parameter variable">-s</span> <span class="token number">16</span> <span class="token number">1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="允许外网通过密码连接" tabindex="-1"><a class="header-anchor" href="#允许外网通过密码连接"><span>允许外网通过密码连接</span></a></h3><p>默认配置下，PostgreSQL 不允许外网连接通过密码登入数据库。下面介绍如何解除该限制。</p><p>首先编辑<code>/etc/postgresql/*/main/postgresql.conf</code>（这里的<code>*</code>代表 PostgreSQL 的版本号，下同），加入这一行：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">listen_addresses = &#39;*&#39;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后在<code>/etc/postgresql/*/main/pg_hba.conf</code>中加入这一行：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">host  all  all  0.0.0.0/0  scram-sha-256</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>你可以通过下面的命令快速编辑配置文件：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;listen_addresses = &#39;*&#39;&quot;</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/postgresql/*/main/postgresql.conf</span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;host  all  all  0.0.0.0/0  scram-sha-256&quot;</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/postgresql/*/main/pg_hba.conf</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="将数据库文件移动至数据盘中" tabindex="-1"><a class="header-anchor" href="#将数据库文件移动至数据盘中"><span>将数据库文件移动至数据盘中</span></a></h3><p>默认情况下，PostgreSQL 的数据库文件存储在<code>/var/lib/postgresql/*/main/</code>下面。可以通过软链接将数据库文件迁移到别的目录。此外要注意定期备份。</p><h2 id="启动" tabindex="-1"><a class="header-anchor" href="#启动"><span>启动</span></a></h2><p>输入以下命令即可启动 PostgreSQL，并设置开机自动启动：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">service</span> postgresql start</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">service</span> postgresql <span class="token builtin class-name">enable</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>这里有一个坑，就是<code>postgresql</code>并不是一个真实存在的 service。真正的 PostgreSQL service 名称是带版本号的。<code>postgresql</code>这个 service 只不过是重定向至真正的 service 而已。因此，如果你输入<code>sudo service postgresql status</code>，那么不管 PostgreSQL 有没有成功启动，你看到的状态都会是<code>active (exited)</code>。要想看到真正的运行状态，就要输入：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">service</span> postgresql* status</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,27)])])}const o=e(i,[["render",t]]),r=JSON.parse('{"path":"/posts/2024/11/ubuntu-install-pgsql.html","title":"Ubuntu安装PostgreSQL的教程","lang":"zh-CN","frontmatter":{"date":"2024-11-20T00:00:00.000Z"},"headers":[{"level":2,"title":"安装","slug":"安装","link":"#安装","children":[]},{"level":2,"title":"配置","slug":"配置","link":"#配置","children":[{"level":3,"title":"创建新用户和数据库","slug":"创建新用户和数据库","link":"#创建新用户和数据库","children":[]},{"level":3,"title":"允许外网通过密码连接","slug":"允许外网通过密码连接","link":"#允许外网通过密码连接","children":[]},{"level":3,"title":"将数据库文件移动至数据盘中","slug":"将数据库文件移动至数据盘中","link":"#将数据库文件移动至数据盘中","children":[]}]},{"level":2,"title":"启动","slug":"启动","link":"#启动","children":[]}],"git":{"updatedTime":1763699399000,"contributors":[{"name":"shi0rik0","username":"shi0rik0","email":"anguuan@outlook.com","commits":2,"url":"https://github.com/shi0rik0"}],"changelog":[{"hash":"35d50711ef3a591a2383977aa02873c707aa5c1e","time":1763699399000,"email":"anguuan@outlook.com","author":"shi0rik0","message":"Organize files by date"},{"hash":"27621ea60c6645dc9e44007e7ab6fd2858c37eaf","time":1763698804000,"email":"anguuan@outlook.com","author":"shi0rik0","message":"Migrate posts"}]},"filePathRelative":"posts/2024/11/ubuntu-install-pgsql.md","excerpt":"\\n<h2>安装</h2>\\n<p>使用包管理器就可以直接安装 PostgreSQL：</p>\\n<div class=\\"language-bash line-numbers-mode\\" data-highlighter=\\"prismjs\\" data-ext=\\"sh\\"><pre><code><span class=\\"line\\"><span class=\\"token function\\">sudo</span> <span class=\\"token function\\">apt</span> <span class=\\"token function\\">install</span> postgresql</span>\\n<span class=\\"line\\"></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div></div></div>"}');export{o as comp,r as data};
