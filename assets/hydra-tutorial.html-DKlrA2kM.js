import{_ as s,c as a,d as e,o as p}from"./app-DEX1Ewll.js";const l={};function t(i,n){return p(),a("div",null,[...n[0]||(n[0]=[e(`<h1 id="python配置库hydra的教程" tabindex="-1"><a class="header-anchor" href="#python配置库hydra的教程"><span>Python配置库Hydra的教程</span></a></h1><p>Hydra是Meta团队开发的一个Python库，主要是用来管理配置的。虽然我个人比较反感这种框架，因为我觉得配置本身是一个很简单的需求，没必要搞得这么复杂，但是Habitat仿真器的配置就是用Hydra加载的，所以还是不得不稍微了解一下。</p><p>Hydra配置文件都是用YAML格式编写的，下面是一个例子：</p><p>main.yaml:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line"><span class="token key atrule">defaults</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> _self_</span>
<span class="line">  <span class="token punctuation">-</span> <span class="token key atrule">db/engine</span><span class="token punctuation">:</span> mysql</span>
<span class="line">  <span class="token punctuation">-</span> network</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">db</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">engine</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">name</span><span class="token punctuation">:</span> postgresql</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>db/engine/mysql.yaml:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line"><span class="token key atrule">name</span><span class="token punctuation">:</span> mysql</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>network.yaml:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code><span class="line"><span class="token key atrule">host</span><span class="token punctuation">:</span> localhost</span>
<span class="line"><span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3306</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>那么，加载main.yaml后得到的配置对象是：</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;db&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;engine&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mysql&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;network&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">3306</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来我将解释一下配置文件的细节。</p><p>首先是main.yaml中的<code>defaults</code>字段，这个字段会被Hydra特别处理，它的作用是加载其他配置，所以我觉得其实叫做<code>imports</code>更合适。这个字段是一个列表，列表中的元素可以是以下三种类型：</p><ul><li><code>_self_</code>：表示加载当前配置文件。</li><li>一个键值对，例如<code>db/engine: mysql</code>，表示在<code>db/engine</code>这个group中加载<code>mysql.yaml</code>这个配置文件。（Group是Hydra的一个术语，下面会详细介绍，这里你可以理解为是配置文件所在的目录。）需要注意的是，如果指定了group，Hydra会将分隔符<code>/</code>看作是<code>.</code>，所以<code>db/engine/mysql.yaml</code>中的配置都会被放在<code>db.engine</code>这个对象中。</li><li>一个字符串，例如<code>network</code>，表示加载<code>network.yaml</code>这个配置文件。</li></ul><p>优先级方面，在<code>defaults</code>列表中越靠后的配置优先级越高。</p><p>接下来要介绍一下group这个概念。Hydra的group有两种实现方法，一种是用文件夹来实现，一种是用ConfigStore来实现。用文件夹实现很好理解，比如说group是<code>db/engine</code>，那么就会在这个文件夹下面查找配置文件。而用ConfigStore实现就是用代码来添加group，下面是一个例子：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> hydra<span class="token punctuation">.</span>core<span class="token punctuation">.</span>config_store <span class="token keyword">import</span> ConfigStore</span>
<span class="line"><span class="token keyword">from</span> dataclasses <span class="token keyword">import</span> dataclass</span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@dataclass</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MySQLConfig</span><span class="token punctuation">:</span></span>
<span class="line">    name<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token string">&quot;mysql&quot;</span></span>
<span class="line"></span>
<span class="line">cs <span class="token operator">=</span> ConfigStore<span class="token punctuation">.</span>instance<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 效果等同于创建一个db/engine/mysql.yaml文件</span></span>
<span class="line">cs<span class="token punctuation">.</span>store<span class="token punctuation">(</span>group<span class="token operator">=</span><span class="token string">&quot;db/engine&quot;</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&quot;mysql&quot;</span><span class="token punctuation">,</span> node<span class="token operator">=</span>MySQLConfig<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>所以说，当你看到一个group的时候，要么在Hydra的搜索路径下看看有没有这个文件夹，要么在代码里看看有没有注册过这个group。</p><p>还有一点，一个Hydra应用是可以通过命令行参数来覆盖或者新增配置的，如果是覆盖配置，就传入<code>key=value</code>，如果是新增配置，就传入<code>+key=value</code>（需要一个加号）。例如：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">python main.py <span class="token assign-left variable">db.engine.name</span><span class="token operator">=</span>sqlite +db.engine.version<span class="token operator">=</span><span class="token number">3.0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,20)])])}const c=s(l,[["render",t]]),r=JSON.parse('{"path":"/posts/2025/04/hydra-tutorial.html","title":"Python配置库Hydra的教程","lang":"zh-CN","frontmatter":{"date":"2025-04-30T00:00:00.000Z"},"headers":[],"git":{"updatedTime":1763699399000,"contributors":[{"name":"shi0rik0","username":"shi0rik0","email":"anguuan@outlook.com","commits":2,"url":"https://github.com/shi0rik0"}],"changelog":[{"hash":"35d50711ef3a591a2383977aa02873c707aa5c1e","time":1763699399000,"email":"anguuan@outlook.com","author":"shi0rik0","message":"Organize files by date"},{"hash":"27621ea60c6645dc9e44007e7ab6fd2858c37eaf","time":1763698804000,"email":"anguuan@outlook.com","author":"shi0rik0","message":"Migrate posts"}]},"filePathRelative":"posts/2025/04/hydra-tutorial.md","excerpt":"\\n<p>Hydra是Meta团队开发的一个Python库，主要是用来管理配置的。虽然我个人比较反感这种框架，因为我觉得配置本身是一个很简单的需求，没必要搞得这么复杂，但是Habitat仿真器的配置就是用Hydra加载的，所以还是不得不稍微了解一下。</p>\\n<p>Hydra配置文件都是用YAML格式编写的，下面是一个例子：</p>\\n<p>main.yaml:</p>\\n<div class=\\"language-yaml line-numbers-mode\\" data-highlighter=\\"prismjs\\" data-ext=\\"yml\\"><pre><code><span class=\\"line\\"><span class=\\"token key atrule\\">defaults</span><span class=\\"token punctuation\\">:</span></span>\\n<span class=\\"line\\">  <span class=\\"token punctuation\\">-</span> _self_</span>\\n<span class=\\"line\\">  <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">db/engine</span><span class=\\"token punctuation\\">:</span> mysql</span>\\n<span class=\\"line\\">  <span class=\\"token punctuation\\">-</span> network</span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span class=\\"token key atrule\\">db</span><span class=\\"token punctuation\\">:</span></span>\\n<span class=\\"line\\">  <span class=\\"token key atrule\\">engine</span><span class=\\"token punctuation\\">:</span></span>\\n<span class=\\"line\\">    <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> postgresql</span>\\n<span class=\\"line\\"></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>"}');export{c as comp,r as data};
