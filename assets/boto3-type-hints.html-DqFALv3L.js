import{_ as n,c as e,d as a,o as t}from"./app-DEX1Ewll.js";const o={};function i(c,s){return t(),e("div",null,[...s[0]||(s[0]=[a(`<h1 id="给boto3增加type-hints" tabindex="-1"><a class="header-anchor" href="#给boto3增加type-hints"><span>给boto3增加type hints</span></a></h1><p>最近使用<code>boto3</code>的时候，发现<code>boto3.client()</code>的返回值没有标注类型，导致开发的时候很不方便。我原先以为是<code>boto3</code>的开发者忘了添加，后来看了源代码才知道，<code>boto3.client()</code>返回的对象的 class 是在运行时动态生成的，所以很难进行 type hints。（这就是动态语言的坏处啊！）</p><p>好在有个开发者生成了<code>boto3</code>各种 client 的 stub，包名叫<code>boto3-stubs</code>。假如使用的是 S3 client，就输入：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">pip <span class="token function">install</span> boto3-stubs<span class="token punctuation">[</span>s3<span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后在 VSCode 里输入：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">client <span class="token operator">=</span> boto3<span class="token punctuation">.</span>client<span class="token punctuation">(</span><span class="token string">&#39;s3&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>应该就会看到<code>client</code>已经被自动推断出了类型。</p><p>假如我们需要给接受 S3 client 的函数参数标注类型，就要这么写：</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> typing <span class="token keyword">import</span> TYPE_CHECKING</span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> TYPE_CHECKING<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">from</span> mypy_boto3_s3<span class="token punctuation">.</span>client <span class="token keyword">import</span> S3Client</span>
<span class="line"><span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">    S3Client <span class="token operator">=</span> <span class="token builtin">object</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> S3Client<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">pass</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>TYPE_CHECKING</code>是一个特殊常量，对于代码分析器，它的值为 True，正常运行时则为 False。加上<code>S3Client = object</code>的作用则是为了保证运行时<code>S3Client</code>依然是被定义的变量，不然执行时会报错。这个问题也可以通过加上<code>from __future__ import annotations</code>来解决。</p>`,10)])])}const l=n(o,[["render",i]]),d=JSON.parse('{"path":"/posts/2024/11/boto3-type-hints.html","title":"给boto3增加type hints","lang":"zh-CN","frontmatter":{"date":"2024-11-15T00:00:00.000Z"},"headers":[],"git":{"updatedTime":1763699399000,"contributors":[{"name":"shi0rik0","username":"shi0rik0","email":"anguuan@outlook.com","commits":2,"url":"https://github.com/shi0rik0"}],"changelog":[{"hash":"35d50711ef3a591a2383977aa02873c707aa5c1e","time":1763699399000,"email":"anguuan@outlook.com","author":"shi0rik0","message":"Organize files by date"},{"hash":"27621ea60c6645dc9e44007e7ab6fd2858c37eaf","time":1763698804000,"email":"anguuan@outlook.com","author":"shi0rik0","message":"Migrate posts"}]},"filePathRelative":"posts/2024/11/boto3-type-hints.md","excerpt":"\\n<p>最近使用<code>boto3</code>的时候，发现<code>boto3.client()</code>的返回值没有标注类型，导致开发的时候很不方便。我原先以为是<code>boto3</code>的开发者忘了添加，后来看了源代码才知道，<code>boto3.client()</code>返回的对象的 class 是在运行时动态生成的，所以很难进行 type hints。（这就是动态语言的坏处啊！）</p>\\n<p>好在有个开发者生成了<code>boto3</code>各种 client 的 stub，包名叫<code>boto3-stubs</code>。假如使用的是 S3 client，就输入：</p>"}');export{l as comp,d as data};
